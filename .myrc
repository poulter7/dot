echo "Sourcing $0"

alias resource="echo Sourcing ~/.zshrc && source ~/.zshrc"

myrconetime(){
	# install brew
	echo "[brew]"
	which -s brew
	if [[ $? != 0 ]] ; then
	    # install homebrew
	    echo "installing"
	    ruby -e "$(curl -fssl https://raw.githubusercontent.com/homebrew/install/master/install)"
	else
	    echo "updating"
	    brew update
	fi

	echo "[vimac]"
	if [[ ! -d "/applications/vimac.app" ]]; then
		echo "installing"
		# install vimac
		brew tap kidonng/malt
		brew install vimac
	else
		echo "already installed"
	fi

	echo "[tmux]"
	if ! [ -x  "$(command -v tmux)" ]; then
		echo "installing"
		brew install tmux

		echo "[tmux conf]"
		curl -s https://raw.githubusercontent.com/poulter7/dot/main/tmux/.tmux.conf > ~/.tmux.conf
	else
		echo "already installed"
	fi


	echo "[lvim]"
	if ! [ -x  "$(command -v lvim)" ]; then
		  LV_BRANCH='release-1.2/neovim-0.8' bash <(curl -s https://raw.githubusercontent.com/lunarvim/lunarvim/master/utils/installer/install.sh)
		curl -s https://raw.githubusercontent.com/poulter7/dot/main/lvim/config.lua > ~/.config/lvim/config.lua
	else
		echo "already installed"
	fi
	alias vim=lvim
}

myrcstartup(){
	echo "Startup"
	# Load tmux
	if command -v tmux &> /dev/null && [ -n "$PS1" ] && [[ ! "$TERM" =~ screen ]] && [[ ! "$TERM" =~ tmux ]] && [ -z "$TMUX" ]; then
	  echo "Executing tmux"
	  exec tmux
	else
	  echo "Skipped tmux"
	fi
	remap_keys(){
		hidutil property --set '{"UserKeyMapping":[
		{"HIDKeyboardModifierMappingSrc":0x7000000E7,"HIDKeyboardModifierMappingDst":0x700000044},
		{"HIDKeyboardModifierMappingSrc":0x7000000E6,"HIDKeyboardModifierMappingDst":0x700000045},
		]}'
	}
	remap_keys || true
}

# myrconetime
myrcstartup
